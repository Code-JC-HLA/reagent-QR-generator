<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reagent QR Code Generator</title>
  <style>
    :root {
      --spacing: 1rem;
      --input-font: 1rem;
      --label-font: 0.95rem;
      --header-font: 1.2rem;
      --button-bg: #0366d6;
      --button-color: #fff;
      --button-hover: #024ea2;
      --border-radius: 4px;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: var(--spacing);
      line-height: 1.4;
      color: #333;
    }

    h1 {
      font-size: var(--header-font);
      margin-bottom: var(--spacing);
    }

    form {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: var(--spacing);
      align-items: end;
      margin-bottom: var(--spacing);
    }

    .task-timestamp {
      display: flex;
      flex-direction: column;
      gap: var(--spacing);
    }

    label {
      font-size: var(--label-font);
    }

    input, select {
      font-size: var(--input-font);
      padding: 0.4em;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
    }

    .reagents {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: calc(var(--spacing) / 2);
      margin-top: var(--spacing);
    }

    .reagent-row {
      display: grid;
      grid-template-areas:
        "name name"
        "lot exp";
      grid-template-columns: 1fr 1fr;
      gap: 0.5em;
      padding: 0.75em;
      border: 1px solid #e1e4e8;
      border-radius: var(--border-radius);
    }

    .reagent-row label:nth-of-type(1) { grid-area: name; }
    .reagent-row label:nth-of-type(2) { grid-area: lot-label; }
    .reagent-row label:nth-of-type(3) { grid-area: exp-label; }
    .reagent-row input:nth-of-type(2) { grid-area: lot; }
    .reagent-row input:nth-of-type(3) { grid-area: exp; }

    .reagent-row label[for$="-lot"] {
      align-self: center;
      font-size: var(--label-font);
    }

    .reagent-row label[for$="-exp"] {
      align-self: center;
      font-size: var(--label-font);
    }

    button {
      background-color: var(--button-bg);
      color: var(--button-color);
      border: none;
      padding: 0.6em 1.2em;
      font-size: var(--input-font);
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: var(--button-hover);
    }

    #controls {
      display: flex;
      gap: var(--spacing);
    }

    #qr-container {
      text-align: center;
      margin-bottom: var(--spacing);
    }

    #result-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--spacing);
      font-size: var(--label-font);
    }

    #result-table td {
      border: 1px solid #d1d5da;
      padding: 0.5em;
    }

    #result-table tr:nth-child(odd) {
      background-color: #f6f8fa;
    }

    /* Hide table until generated */
    #output-section {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Reagent QR Code Generator</h1>

  <form id="qr-form">
    <div class="task-timestamp">
      <div>
        <label for="tasklist">Tasklist</label><br>
        <input id="tasklist" type="text" placeholder="e.g. ABS-1059" title="Enter your tasklist code" required>
      </div>
      <div>
        <label for="timestamp">Generated</label><br>
        <input id="timestamp" type="text" readonly>
      </div>
    </div>

    <div id="controls">
      <button id="generate-btn" type="button">Generate QR Code</button>
      <button id="print-btn" type="button">Print</button>
    </div>
  </form>

  <div id="qr-container">
    <canvas id="qr-code"></canvas>
  </div>

  <section id="output-section">
    <table id="result-table">
      <!-- populated dynamically -->
    </table>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const reagents = [
        'SAB Class I',
        'SAB Class II',
        'ExPlex Class I',
        'ExPlex Class II',
        'Negative Control',
        'Class I Positive Control',
        'Class II Positive Control',
        'EDTA',
        'Anti-IgG PE Stain',
        'Wash Buffer',
        'PBS'
      ];

      const form = document.getElementById('qr-form');
      const taskInput = document.getElementById('tasklist');
      const tsInput = document.getElementById('timestamp');
      const qrCanvas = document.getElementById('qr-code');
      const outputSection = document.getElementById('output-section');
      const resultTable = document.getElementById('result-table');
      const generateBtn = document.getElementById('generate-btn');
      const printBtn = document.getElementById('print-btn');

      const qr = new QRious({
        element: qrCanvas,
        size: 250,
        level: 'H'
      });

      function buildForm() {
        const container = document.createElement('div');
        container.className = 'reagents';
        reagents.forEach(name => {
          const row = document.createElement('div');
          row.className = 'reagent-row';
          row.innerHTML = `
            <label>${name}</label>
            <label for="${name}-lot">Lot No.</label>
            <input id="${name}-lot" type="text" placeholder="Enter lot" title="Lot number for ${name}" required>
            <label for="${name}-exp">Exp.</label>
            <input id="${name}-exp" type="date" title="Expiration date for ${name}" required>
          `;
          container.appendChild(row);
        });
        form.insertBefore(container, document.getElementById('controls'));
      }

      function generateQR() {
        if (!form.reportValidity()) return;
        const timestamp = new Date().toISOString().slice(0,19).replace('T', ' ');
        tsInput.value = timestamp;

        let data = `Tasklist: ${taskInput.value}\nGenerated: ${timestamp}`;
        reagents.forEach(name => {
          const lot = document.getElementById(`${name}-lot`).value.trim().toUpperCase();
          const exp = document.getElementById(`${name}-exp`).value;
          data += `\n${name} | Lot: ${lot} | Exp: ${exp}`;
        });

        qr.value = data;

        // build table
        resultTable.innerHTML = '';
        const addRow = (f, v) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${f}</td><td>${v}</td>`;
          resultTable.appendChild(tr);
        };
        addRow('Tasklist', taskInput.value);
        addRow('Generated', timestamp);
        reagents.forEach(name => {
          const lot = document.getElementById(`${name}-lot`).value.trim().toUpperCase();
          const exp = document.getElementById(`${name}-exp`).value;
          addRow(name, `Lot: ${lot} | Exp: ${exp}`);
        });

        outputSection.style.display = 'block';
      }

      function printQR() {
        window.print();
      }

      buildForm();
      generateBtn.addEventListener('click', generateQR);
      printBtn.addEventListener('click', printQR);
    });
  </script>
</body>
</html>
